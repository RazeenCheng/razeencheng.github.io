<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 3.9.0"><link rel="apple-touch-icon" sizes="180x180" href="https://st.razeen.cn/static/img/avatar.png"><link rel="icon" type="image/png" sizes="32x32" href="https://st.razeen.cn/static/img/avatar.png"><link rel="icon" type="image/png" sizes="16x16" href="https://st.razeen.cn/static/img/avatar.png"><link rel="mask-icon" href="https://st.razeen.cn/static/img/avatar.png" color="#222"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://st.razeen.cn/next2021/lib/font-awesome/css/all.min.css"><link rel="stylesheet" href="https://st.razeen.cn/next2021/lib/fancybox/jquery.fancybox.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"razeencheng.com",root:"/",scheme:"Pisces",version:"7.8.0",exturl:!1,sidebar:{position:"right",display:"post",padding:18,offset:12,onmobile:!0},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!0,pangu:!1,comments:{style:"tabs",active:"disqus",storage:!0,lazyload:!1,nav:{gitalk:{text:"Gitalk",order:-1},disqus:{text:"Disqus",order:-2}},activeClass:"disqus"},algolia:{appID:"XUUWC2A8SN",apiKey:"8b6cfdd6ec397436fa16561c1bb8f526",indexName:"razeenblog",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!1,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="在家里搭建了一个 GitLab 服务器，由于电信家庭宽带的公网 IP 是不固定的，且443端口是被封的，所以买了阿里云作为中转，利用 Ngnix 作 TCP Proxy 结合 DDNS ，这样就能正常上自己的 Git 了。但今天，我发现推代码怎么也推不上去，校对了密钥，服务器状态都没问题。最后上阿里云，重启了下 Nginx，发现可以了。 找了一圈原因，最后发现是 Nginx 转发缓存 DNS 解析"><meta name="keywords" content="nginx,dns cache, http_proxy1"><meta property="og:type" content="article"><meta property="og:title" content="记一次 Nginx DNS 缓存导致转发问题"><meta property="og:url" content="https://razeencheng.com/post/nginx-proxy-problem-with-dns-cache.html"><meta property="og:site_name" content="Razeen`s Blog"><meta property="og:description" content="在家里搭建了一个 GitLab 服务器，由于电信家庭宽带的公网 IP 是不固定的，且443端口是被封的，所以买了阿里云作为中转，利用 Ngnix 作 TCP Proxy 结合 DDNS ，这样就能正常上自己的 Git 了。但今天，我发现推代码怎么也推不上去，校对了密钥，服务器状态都没问题。最后上阿里云，重启了下 Nginx，发现可以了。 找了一圈原因，最后发现是 Nginx 转发缓存 DNS 解析"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2021-07-10T09:23:16.412Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="记一次 Nginx DNS 缓存导致转发问题"><meta name="twitter:description" content="在家里搭建了一个 GitLab 服务器，由于电信家庭宽带的公网 IP 是不固定的，且443端口是被封的，所以买了阿里云作为中转，利用 Ngnix 作 TCP Proxy 结合 DDNS ，这样就能正常上自己的 Git 了。但今天，我发现推代码怎么也推不上去，校对了密钥，服务器状态都没问题。最后上阿里云，重启了下 Nginx，发现可以了。 找了一圈原因，最后发现是 Nginx 转发缓存 DNS 解析"><link rel="canonical" href="https://razeencheng.com/post/nginx-proxy-problem-with-dns-cache.html"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>记一次 Nginx DNS 缓存导致转发问题 | Razeen`s Blog</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-82194091-1"></script><script>function gtag(){dataLayer.push(arguments)}CONFIG.hostname===location.hostname&&(window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-82194091-1"))</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?e9d432ff1948379070213295f6a8068f";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><script data-ad-client="ca-pub-4450478767591566" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">Razeen`s Blog</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">Stay hungry, Stay foolish.</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">61</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">25</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">89</span></a></li><li class="menu-item menu-item-reading"><a href="/reading/" rel="section"><i class="fa fa-book fa-fw"></i>读书</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://razeencheng.com/post/nginx-proxy-problem-with-dns-cache.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://st.razeen.cn/static/img/avatar.png"><meta itemprop="name" content="Razeen"><meta itemprop="description" content="My name is ChengJin, I use @Razeen and @RazeenCheng on web. I'm a gopher+. Currently I'm working for a company about information security."></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Razeen`s Blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">记一次 Nginx DNS 缓存导致转发问题</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-03-06 07:01:51" itemprop="dateCreated datePublished" datetime="2021-03-06T07:01:51+00:00">2021-03-06</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类在</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/dev-daily/" itemprop="url" rel="index"><span itemprop="name">开发实战总结</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><p>在家里搭建了一个 GitLab 服务器，由于电信家庭宽带的公网 IP 是不固定的，且<code>443</code>端口是被封的，所以买了阿里云作为中转，利用 Ngnix 作 TCP Proxy 结合 DDNS ，这样就能正常上自己的 Git 了。但今天，我发现推代码怎么也推不上去，校对了密钥，服务器状态都没问题。最后上阿里云，重启了下 Nginx，发现可以了。 找了一圈原因，最后发现是 Nginx 转发缓存 DNS 解析导致的，下面我们就复现一下问题并找找为什么，以及解决方式。</p><a id="more"></a><h3 id="复现问题"><a href="#复现问题" class="headerlink" title="复现问题"></a>复现问题</h3><blockquote><p>系统： CentOS 8.3.2011</p><p>Nginx : nginx/1.14.1</p></blockquote><ol><li>直接在默认配置中加上如下配置，其中本地的<code>80</code>端口跑的是 Nginx 默认的服务：</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">stream</span> &#123;</span><br><span class="line">    <span class="attribute">log_format</span> basic <span class="string">'<span class="variable">$remote_addr</span> [<span class="variable">$time_local</span>] '</span></span><br><span class="line">                 <span class="string">'<span class="variable">$protocol</span> <span class="variable">$status</span> <span class="variable">$bytes_sent</span> <span class="variable">$bytes_received</span> '</span></span><br><span class="line">                 <span class="string">'<span class="variable">$session_time</span> "<span class="variable">$upstream_addr</span>"'</span>;</span><br><span class="line"></span><br><span class="line">	<span class="attribute">access_log</span> /var/logs/nginx/access2.log basic;</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">8080</span>；</span><br><span class="line">        proxy_pass test.razeen.cn:<span class="number">80</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此时，<code>test.razeen.cn</code>并没有解析，直接启动<code>nginx</code>，会报错:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nignx: [emerg] host not found <span class="keyword">in</span> upstream <span class="string">"test.razeen.cn"</span> <span class="keyword">in</span> /etc/nginx/nginx.conf:94</span><br></pre></td></tr></table></figure><ol start="2"><li>我添加解析。</li></ol><p><img data-src="https://st.razeen.cn/img/20210306224001_image-20210306224001679.png" alt="image-20210306224001679"></p><p>再次启动，成功启动 nginx, 访问 <code>8080</code> 端口，页面成功展示，日志如下：</p><p><img data-src="https://st.razeen.cn/img/20210306225944_image-20210306225944957.png" alt="image-20210306225944957"></p><p>一切正常。</p><ol start="3"><li>修改解析，解析到其他IP。</li></ol><p><img data-src="https://st.razeen.cn/img/20210306230154_image-20210306230154560.png" alt="image-20210306230154560"></p><p>600s后，无论我们再次访问，查看日志，还是转到了原来的 IP。</p><p><img data-src="https://st.razeen.cn/img/20210306230748_image-20210306230748682.png" alt="image-20210306230748682"></p><ol start="4"><li>重启 nginx, 再次访问，这是 IP 才变成后面修改的。</li></ol><p><img data-src="https://st.razeen.cn/img/20210306231106_image-20210306231106575.png" alt="image-20210306231106575"></p><p>从这里可以看出，Nginx 在启动的时候就会去查询DNS记录，如果不存在解析，直接无法启动。 但，如果中间修改域名的 DNS 解析，Nginx 中的解析并不会刷新。只有 <code>reload or restart</code> 后才会刷新。</p><p>那么实际是什么样的呢？</p><h3 id="解析机制"><a href="#解析机制" class="headerlink" title="解析机制"></a>解析机制</h3><p>直接去查找了一下相关的文章, 从这篇<a href="https://www.nginx.com/blog/dns-service-discovery-nginx-plus/" target="_blank" rel="noopener">Using DNS for Service Discovery with NGINX and NGINX Plus</a> 我们知道:</p><blockquote><p>As NGINX starts up or reloads its configuration, it queries a DNS server to resolve <strong>backends.example.com</strong>. The DNS server returns the list of three backends discussed above, and NGINX uses the default Round Robin algorithm to load balance requests among them. NGINX chooses the DNS server from the OS configuration file <strong>/etc/resolv.conf</strong>.</p><p>This method is the least flexible way to do service discovery and has the following additional drawbacks:</p><ul><li>If the domain name can’t be resolved, NGINX fails to start or reload its configuration.</li><li>NGINX caches the DNS records until the next restart or configuration reload, ignoring the records’ TTL values.</li><li>We can’t specify another load‑balancing algorithm, nor can we configure passive health checks or other features defined by parameters to the <code>server</code> directive, which we’ll describe in the next section.</li></ul></blockquote><ul><li>Nginx 在启动/重载的时候回去解析转发的域名</li><li>如果域名无法解析 Nginx 就无法启动</li><li>只有下次重启/重载的时候才会重新去解析，启动后无视TTL</li></ul><p><em>同时，如果能解析到多个 IP，还会有相应的负载均衡策略哦，后面可以再研究下这个。</em></p><p>这下就很明白了，原来坑就在这里，那么该怎么解决呢？</p><h3 id="解决问题"><a href="#解决问题" class="headerlink" title="解决问题"></a>解决问题</h3><p>在上面的文章中其实就给出了一种解决方案。</p><p>如下，我们可以指定 DNS 解析服务器并设置 DNS 刷新频率。</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">resolver</span> <span class="number">10.0.0.2</span> valid=<span class="number">10s</span>;</span><br><span class="line"></span><br><span class="line">	<span class="section">server</span> &#123;</span><br><span class="line">        <span class="comment"># resolver 10.0.0.2 valid=10s;  # 也可以写在这里</span></span><br><span class="line">    	<span class="attribute">location</span> / &#123;</span><br><span class="line">            <span class="comment"># resolver 10.0.0.2 valid=10s;   # 也可以写在这</span></span><br><span class="line">        	<span class="attribute">set</span> <span class="variable">$backend_servers</span> backends.example.com;</span><br><span class="line">        	<span class="attribute">proxy_pass</span> http://<span class="variable">$backend_servers</span>:8080;</span><br><span class="line">    	&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面，<code>resolver</code>就是 DNS 服务器的地址， <code>valid</code>是 DNS 刷新的频率<sup>[1]</sup>。</p><p>但，上面这种写法只适合在 <code>http proxy</code>中，在<code>stream proxy</code>中并没有<code>set</code>关键字，如果这么写启动会直接报错。查阅一番后，如下写法是可行的:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">stream</span> &#123;</span><br><span class="line">    <span class="attribute">resolver</span> <span class="number">114.114.114.114</span> valid=<span class="number">10s</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">map</span> <span class="variable">$remote_addr</span> <span class="variable">$backend</span> &#123;</span><br><span class="line">        <span class="attribute">default</span>  test.razeen.cn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">8080</span>;</span><br><span class="line">        <span class="comment"># resolver 114.114.114.114 valid=10s;  # 也可以写在这里</span></span><br><span class="line">        <span class="attribute">proxy_pass</span> <span class="variable">$backend</span>:<span class="number">80</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>[1]</strong> 但经过验证，这个 <code>valid</code> DNS 刷新频率还要取决于你<code>resolver</code>中使用的解析服务器。如果<code>resolver</code>不是无缓存的DNS服务器，解析生效就会受影响。</p><p>同时通过 <a href="http://nginx.org/en/docs/stream/ngx_stream_core_module.html" target="_blank" rel="noopener">官方文档</a> 看到，在 <code>stream proxy</code> 中 <code>resolver</code> 既可以写在 <code>steam</code>中，也可以写在<code>server</code>中:</p><blockquote><table><thead><tr><th style="text-align:left">Syntax:</th><th>`<strong>resolver</strong> <em>address</em> … [valid=<em>time</em>] [ipv6=on</th><th>off] [status_zone=<em>zone</em>];`</th></tr></thead><tbody><tr><td style="text-align:left">Default:</td><td>—</td></tr><tr><td style="text-align:left">Context:</td><td><code>stream</code>, <code>server</code></td></tr></tbody></table><p>This directive appeared in version 1.11.3.</p></blockquote><p>在 <a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#resolver" target="_blank" rel="noopener">HTTP PRXOY</a>, <code>resolver</code>可以写在<code>http</code>, <code>server</code>, <code>location</code> 中, <code>set</code> 可以写在<code>server</code>和<code>location</code>中。</p><p>同时上面这样写后，即使域名解析不到也不会导致 Nginx 启动/重启 失败。</p><p>在<a href="https://segmentfault.com/a/1190000022365954" target="_blank" rel="noopener">这篇文章</a>中还提供了其他几种设置方法，也可以参考。</p></div><div class="popular-posts-header">相关文章</div><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><a href="/post/nginx-tls1.3-draft26.html" rel="bookmark">TLS1.3正式更新，为Nginx添加TLS1.3的支持</a></div></li></ul><div class="reward-container"><div>如果觉得文章对您有帮助，点两下右边广告将是对我莫大的鼓励，非常感谢！</div><button onclick='var qr=document.getElementById("qr");qr.style.display="none"===qr.style.display?"block":"none"'>打赏</button><div id="qr" style="display:none"><div style="display:inline-block"><img src="https://st.razeen.cn/img/20210702001743-image-20210702001741636.png" alt="Razeen 微信支付"><p>微信支付</p></div></div></div><div class="followme"><p>欢迎关注我的其它发布渠道</p><div class="social-list"><div class="social-item"><a target="_blank" class="social-link" href="https://twitter.com/razeencheng"><span class="icon"><i class="fab fa-twitter"></i> </span><span class="label">Twitter</span></a></div><div class="social-item"><a target="_blank" class="social-link" href="/atom.xml"><span class="icon"><i class="fa fa-rss"></i> </span><span class="label">RSS</span></a></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/nginx/" rel="tag"># nginx</a> <a href="/tags/dns/" rel="tag"># dns</a></div><div class="post-nav"><div class="post-nav-item"><a href="/post/yue-me-bridge.html" rel="prev" title="电信悦me网关修改桥接模式，路由器拨号"><i class="fa fa-chevron-left"></i> 电信悦me网关修改桥接模式，路由器拨号</a></div><div class="post-nav-item"><a href="/post/shanghai-kindergarten-policy-2021.html" rel="next" title="宝宝入幼儿园全程记录（2021年上海托幼入园政策解读）">宝宝入幼儿园全程记录（2021年上海托幼入园政策解读） <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="tabs tabs-comment"><ul class="nav-tabs"><li class="tab"><a href="#comment-disqus">Disqus</a></li><li class="tab"><a href="#comment-gitalk">Gitalk</a></li></ul><div class="tab-content"><div class="tab-pane disqus" id="comment-disqus"><div class="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript></div></div></div><div class="tab-pane gitalk" id="comment-gitalk"><div class="comments" id="gitalk-container"></div></div></div></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#复现问题"><span class="nav-number">1.</span> <span class="nav-text">复现问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解析机制"><span class="nav-number">2.</span> <span class="nav-text">解析机制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解决问题"><span class="nav-number">3.</span> <span class="nav-text">解决问题</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Razeen" src="https://st.razeen.cn/static/img/avatar.png"><p class="site-author-name" itemprop="name">Razeen</p><div class="site-description" itemprop="description">My name is ChengJin, I use @Razeen and @RazeenCheng on web. I'm a gopher+. Currently I'm working for a company about information security.</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">61</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">25</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">89</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/razeencheng" title="GitHub → https://github.com/razeencheng" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:me@razeen.me" title="E-Mail → mailto:me@razeen.me" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a></span></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://yryz.net/" title="https://yryz.net/" rel="noopener" target="_blank">一人游走</a></li><li class="links-of-blogroll-item"><a href="https://deepzz.com/" title="https://deepzz.com/" rel="noopener" target="_blank">Deepzz</a></li><li class="links-of-blogroll-item"><a href="https://wangcch.cc/" title="https://wangcch.cc/" rel="noopener" target="_blank">Demon Wang</a></li><li class="links-of-blogroll-item"><a href="http://blog.tommyyang.cn/" title="http://blog.tommyyang.cn/" rel="noopener" target="_blank">Tommy Yang’s Blog</a></li></ul></div></div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4450478767591566" data-ad-slot="8164928618" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Razeen</span></div><div class="seal"><img style="width:auto;height:44px;cursor:pointer;display:inline-block;margin-right:5px" onclick='window.open("https://myssl.com/seal/detail?domain=razeencheng.com","TrustAsia 安全签章","height=800,width=470,top=0,right=0,toolbar=no,menubar=no,scrollbars=no,resizable=no,location=no,status=no")' src="https://sealres.trustasia.com/seal/img/1x/seal.png?domain=razeencheng.com" alt="TrustAsia 安全签章"></div></div></footer></div><script src="https://st.razeen.cn/next2021/lib/anime.min.js"></script><script src="https://st.razeen.cn/next2021/lib/fancybox/jquery.min.js"></script><script src="https://st.razeen.cn/next2021/lib/fancybox/jquery.fancybox.min.js"></script><script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script><script src="/js/utils.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script>!function(t,h,e,j){t.hj=t.hj||function(){(t.hj.q=t.hj.q||[]).push(arguments)},t._hjSettings={hjid:1271072,hjsv:6},e=h.getElementsByTagName("head")[0],(j=h.createElement("script")).async=1,j.src="https://static.hotjar.com/c/hotjar-"+t._hjSettings.hjid+".js?sv="+t._hjSettings.hjsv,e.appendChild(j)}(window,document)</script><script>var disqus_config=function(){this.page.url="https://razeencheng.com/post/nginx-proxy-problem-with-dns-cache.html",this.page.identifier="/post/nginx-proxy-problem-with-dns-cache.html",this.page.title="记一次 Nginx DNS 缓存导致转发问题"};NexT.utils.loadComments(document.querySelector("#disqus_thread"),()=>{var e,t;window.DISQUS?DISQUS.reset({reload:!0,config:disqus_config}):((t=(e=document).createElement("script")).src="https://razeen-me.disqus.com/embed.js",t.setAttribute("data-timestamp",""+ +new Date),(e.head||e.body).appendChild(t))})</script><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css"><script>NexT.utils.loadComments(document.querySelector("#gitalk-container"),()=>{NexT.utils.getScript("//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js",()=>{new Gitalk({clientID:"b18687c280aea769c18f",clientSecret:"a59a7ae4e158c9a80707e7ee1e13a3173fc34b7c",repo:"blog-comment",owner:"razeencheng",admin:["razeencheng"],id:"ef3cba0d219917d6ca1137c6566a5dfb",language:"zh-CN",distractionFreeMode:!0}).render("gitalk-container")},window.Gitalk)})</script></body></html>