<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 3.9.0"><link rel="apple-touch-icon" sizes="180x180" href="https://st.razeen.cn/static/img/avatar.png"><link rel="icon" type="image/png" sizes="32x32" href="https://st.razeen.cn/static/img/avatar.png"><link rel="icon" type="image/png" sizes="16x16" href="https://st.razeen.cn/static/img/avatar.png"><link rel="mask-icon" href="https://st.razeen.cn/static/img/avatar.png" color="#222"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://st.razeen.cn/next2021/lib/font-awesome/css/all.min.css"><link rel="stylesheet" href="https://st.razeen.cn/next2021/lib/fancybox/jquery.fancybox.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"razeencheng.com",root:"/",scheme:"Pisces",version:"7.8.0",exturl:!1,sidebar:{position:"right",display:"post",padding:18,offset:12,onmobile:!0},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!0,pangu:!1,comments:{style:"tabs",active:"disqus",storage:!0,lazyload:!1,nav:{gitalk:{text:"Gitalk",order:-1},disqus:{text:"Disqus",order:-2}},activeClass:"disqus"},algolia:{appID:"XUUWC2A8SN",apiKey:"8b6cfdd6ec397436fa16561c1bb8f526",indexName:"razeenblog",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!1,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="OAuth 2.0是一个关于授权的开放网络标准，主要致力于简化客户端人员开发，同时为Web应用程序、桌面应用程序、移动电话和物联网设备提供特定的授权规范。他的官网在这里。在RFC6749中有明确协议规范。简单来说，我们平时使用的很多第三方登录并获取头像等信息就是用的OAuth 2.0。如我们用QQ登录一些论坛，用google账号登陆facebook，用github账号登陆gitlab等。如下图展示"><meta name="keywords" content="golang,OAuth 2.0,OAuth的思路,Auth的实现,运行流程,客户端的授权模式解析"><meta property="og:type" content="article"><meta property="og:title" content="Go学习笔记(七) | 理解OAuth 2.0并实现一个客户端"><meta property="og:url" content="https://razeencheng.com/post/oauth2-protocol-details.html"><meta property="og:site_name" content="Razeen`s Blog"><meta property="og:description" content="OAuth 2.0是一个关于授权的开放网络标准，主要致力于简化客户端人员开发，同时为Web应用程序、桌面应用程序、移动电话和物联网设备提供特定的授权规范。他的官网在这里。在RFC6749中有明确协议规范。简单来说，我们平时使用的很多第三方登录并获取头像等信息就是用的OAuth 2.0。如我们用QQ登录一些论坛，用google账号登陆facebook，用github账号登陆gitlab等。如下图展示"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2021-07-10T09:23:16.412Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Go学习笔记(七) | 理解OAuth 2.0并实现一个客户端"><meta name="twitter:description" content="OAuth 2.0是一个关于授权的开放网络标准，主要致力于简化客户端人员开发，同时为Web应用程序、桌面应用程序、移动电话和物联网设备提供特定的授权规范。他的官网在这里。在RFC6749中有明确协议规范。简单来说，我们平时使用的很多第三方登录并获取头像等信息就是用的OAuth 2.0。如我们用QQ登录一些论坛，用google账号登陆facebook，用github账号登陆gitlab等。如下图展示"><link rel="canonical" href="https://razeencheng.com/post/oauth2-protocol-details.html"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>Go学习笔记(七) | 理解OAuth 2.0并实现一个客户端 | Razeen`s Blog</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-82194091-1"></script><script>function gtag(){dataLayer.push(arguments)}CONFIG.hostname===location.hostname&&(window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-82194091-1"))</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?e9d432ff1948379070213295f6a8068f";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><script data-ad-client="ca-pub-4450478767591566" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">Razeen`s Blog</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">Stay hungry, Stay foolish.</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">61</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">25</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">89</span></a></li><li class="menu-item menu-item-reading"><a href="/reading/" rel="section"><i class="fa fa-book fa-fw"></i>读书</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://razeencheng.com/post/oauth2-protocol-details.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://st.razeen.cn/static/img/avatar.png"><meta itemprop="name" content="Razeen"><meta itemprop="description" content="My name is ChengJin, I use @Razeen and @RazeenCheng on web. I'm a gopher+. Currently I'm working for a company about information security."></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Razeen`s Blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Go学习笔记(七) | 理解OAuth 2.0并实现一个客户端</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-02-07 14:41:58" itemprop="dateCreated datePublished" datetime="2019-02-07T14:41:58+00:00">2019-02-07</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类在</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/go-learn/" itemprop="url" rel="index"><span itemprop="name">Go学习笔记</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/go-learn/go-fighting/" itemprop="url" rel="index"><span itemprop="name">Go实战</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><p>OAuth 2.0是一个关于授权的开放网络标准，主要致力于简化客户端人员开发，同时为Web应用程序、桌面应用程序、移动电话和物联网设备提供特定的授权规范。他的官网在<a href="https://oauth.net/2/" target="_blank" rel="noopener">这里</a>。在<a href="https://tools.ietf.org/html/rfc6749" target="_blank" rel="noopener">RFC6749</a>中有明确协议规范。</p><p>简单来说，我们平时使用的很多第三方登录并获取头像等信息就是用的OAuth 2.0。如我们用QQ登录一些论坛，用google账号登陆facebook，用github账号登陆gitlab等。如下图展示的就是利用QQ登录网易云音乐Web版，其中用到的就是OAuth 2.0。</p><a id="more"></a><p><img data-src="https://st.razeen.cn/img/blog/oauth2-01.png" alt></p><h3 id="理解OAuth-2-0"><a href="#理解OAuth-2-0" class="headerlink" title="理解OAuth 2.0"></a>理解OAuth 2.0</h3><p>在开始编程前，我们先要掌握OAuth 2.0认证的流程是什么样的，下面我们一起走进OAuth 2.0。</p><p><strong><em>下面的情景都以我用QQ登录网易云Web版为例子。</em></strong></p><h4 id="相关名词"><a href="#相关名词" class="headerlink" title="相关名词"></a>相关名词</h4><p>在理解OAuth 2.0前，我们先需要理解下面这几个名词。</p><ul><li><p><code>resource owner</code>： 资源所有者。也就是例子中的我(用户)。</p></li><li><p><code>resource server</code>： 资源服务器，即服务提供商存放用户资源的服务器。例子中就是QQ的资源服务器，存放了我的QQ昵称，QQ头像，性别等等信息。</p></li><li><p><code>client</code>： 客户端，需要得到资源的应用程序。例子中的网易云音乐Web版。</p></li><li><p><code>authorization server</code>：认证服务器，即服务提供商专门用来处理认证的服务器。例子中QQ提供的认证服务器(跳出来让我们扫码登录QQ的这个服务)。</p></li><li><p><code>user-agent</code>：用户代理。我们用来访问客户端的程序，如这里就是浏览器。</p></li></ul><p>总体说来，这种登录流程大概就是这样：</p><p>我<code>(resource owner)</code>需要用QQ<code>(resource server)</code> 在浏览器<code>(user-agent)</code>登录网易云音乐<code>(client)</code>，我们先登录QQ<code>(authorization server)</code>，授权给网易云。然后网易云才能拿着这个授权信息去QQ资源服务器<code>(resource server)</code>获取到我的头像/昵称/性别等信息。</p><p>具体流程我们继续往下看。</p><h4 id="协议流程"><a href="#协议流程" class="headerlink" title="协议流程"></a>协议流程</h4><p>下图来自<a href="https://tools.ietf.org/html/rfc6749" target="_blank" rel="noopener">RFC6749</a>。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">+--------+                               +---------------+</span><br><span class="line">|        |--(A)- Authorization Request -&gt;|   Resource    |</span><br><span class="line">|        |                               |     Owner     |</span><br><span class="line">|        |&lt;-(B)-- Authorization Grant ---|               |</span><br><span class="line">|        |                               +---------------+</span><br><span class="line">|        |</span><br><span class="line">|        |                               +---------------+</span><br><span class="line">|        |--(C)-- Authorization Grant --&gt;| Authorization |</span><br><span class="line">| Client |                               |     Server    |</span><br><span class="line">|        |&lt;-(D)----- Access Token -------|               |</span><br><span class="line">|        |                               +---------------+</span><br><span class="line">|        |</span><br><span class="line">|        |                               +---------------+</span><br><span class="line">|        |--(E)----- Access Token ------&gt;|    Resource   |</span><br><span class="line">|        |                               |     Server    |</span><br><span class="line">|        |&lt;-(F)--- Protected Resource ---|               |</span><br><span class="line">+--------+                               +---------------+</span><br><span class="line"></span><br><span class="line">                Figure 1: Abstract Protocol Flow</span><br></pre></td></tr></table></figure><ul><li><p>(A) 客户端请求<code>resource owner</code>授权；</p><p>这种授权可以是直接向<code>resource owner</code>请求，也可以通过<code>authorization server</code>间接请求。例子中，就是跳转到QQ的<code>authorization server</code>，让用户登录QQ。</p></li><li><p>(B) 用户同意给予授权；</p><p>例子中，用户点击同意，重定向回网易云音乐，这是一种授权模式。在RFC中规定了4中授权模式，具体采用哪一种取决于<code>authorization server</code>，下一小节具体介绍。</p></li><li><p>(C) 客户端拿着上一步的授权，向<code>authorization server</code>申请令牌(access_token)；</p></li><li><p>(D) <code>authorization server</code>确认授权无误后，发放令牌(access_token)；</p></li><li><p>(E) 客户端拿着令牌（access_token）到<code>resource server</code>去获取资源;</p><p>例子中，获取QQ头像，昵称等。</p></li><li><p>(F) <code>resource server</code>确认无误，同意向客户端下发受保护的资源。</p></li></ul><p>下面详细说到其中四种授权模式。</p><h4 id="授权模式"><a href="#授权模式" class="headerlink" title="授权模式"></a>授权模式</h4><p>客户端要得到令牌(access_token), 必须需要得到用户的授权，在OAuth 2.0 中定义了四种授权模式：</p><ul><li>授权码模式 (Authorization Code)</li><li>简化模式 (Implicit)</li><li>密码模式 (Resource Owner Password Credentials)</li><li>客户端模式 (Client Credentials)</li></ul><p>每种模式的使用场景与流程都有一定的差别。</p><h5 id="授权码模式-Authorization-Code"><a href="#授权码模式-Authorization-Code" class="headerlink" title="授权码模式 (Authorization Code)"></a>授权码模式 (Authorization Code)</h5><p>授权码模式的授权流程是基于重定向。我们例子中的用QQ登录网易云就是这种模式，流程图如下(来自RFC6749)：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"> +----------+</span><br><span class="line">  | Resource |</span><br><span class="line">  |   Owner  |</span><br><span class="line">  |          |</span><br><span class="line">  +----------+</span><br><span class="line">       ^</span><br><span class="line">       |</span><br><span class="line">      (B)</span><br><span class="line">  +----|-----+          Client Identifier      +---------------+</span><br><span class="line">  |         -+----(A)-- &amp; Redirection URI ----&gt;|               |</span><br><span class="line">  |  User-   |                                 | Authorization |</span><br><span class="line">  |  Agent  -+----(B)-- User authenticates ---&gt;|     Server    |</span><br><span class="line">  |          |                                 |               |</span><br><span class="line">  |         -+----(C)-- Authorization Code ---&lt;|               |</span><br><span class="line">  +-|----|---+                                 +---------------+</span><br><span class="line">    |    |                                         ^      v</span><br><span class="line">   (A)  (C)                                        |      |</span><br><span class="line">    |    |                                         |      |</span><br><span class="line">    ^    v                                         |      |</span><br><span class="line">  +---------+                                      |      |</span><br><span class="line">  |         |&gt;---(D)-- Authorization Code ---------&apos;      |</span><br><span class="line">  |  Client |          &amp; Redirection URI                  |</span><br><span class="line">  |         |                                             |</span><br><span class="line">  |         |&lt;---(E)----- Access Token -------------------&apos;</span><br><span class="line">  +---------+       (w/ Optional Refresh Token)</span><br><span class="line"></span><br><span class="line">Note: The lines illustrating steps (A), (B), and (C) are broken into</span><br><span class="line">two parts as they pass through the user-agent.</span><br><span class="line"></span><br><span class="line">                  Figure 3: Authorization Code Flow</span><br></pre></td></tr></table></figure><ul><li>(A) 用户访问客户端，客户端将用户重定向到认证服务器；</li><li>(B) 用户选择是否授权；</li><li>(C) 如果用户同意授权，认证服务器重定向到客户端事先指定的地址，而且带上授权码(code)；</li><li>(D) 客户端收到授权码，带着前面的重定向地址，向认证服务器申请访问令牌；</li><li>(E) 认证服务器核对授权码与重定向地址，确认后向客户端发送访问令牌和更新令牌(可选)。</li></ul><p>1）在A中，客户端申请授权，重定向到认证服务器的URI中需要包含这些参数：</p><table><thead><tr><th>参数名称</th><th>参数含义</th><th>是否必须</th></tr></thead><tbody><tr><td>response_type</td><td>授权类型，此处的值为<code>code</code></td><td>必须</td></tr><tr><td>client_id</td><td>客户端ID，客户端到资源服务器注册的ID</td><td>必须</td></tr><tr><td>redirect_uri</td><td>重定向URI</td><td>可选</td></tr><tr><td>scope</td><td>申请的权限范围，多个逗号隔开</td><td>可选</td></tr><tr><td>state</td><td>客户端的当前状态，可以指定任意值，认证服务器会原封不动的返回这个值</td><td>推荐</td></tr></tbody></table><p>RFC6749中例子如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /authorize?response_type=code&amp;client_id=s6BhdRkqt3&amp;state=xyz</span><br><span class="line">     &amp;redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb HTTP/1.1</span><br><span class="line"> Host: server.example.com</span><br></pre></td></tr></table></figure><p>我们在用QQ登录网易云音乐时实际的地址如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">https://graph.qq.com/oauth2.0/show?<span class="built_in">which</span>=Login</span><br><span class="line">		&amp;display=pc</span><br><span class="line">		&amp;client_id=100495085</span><br><span class="line">		&amp;response_type=code</span><br><span class="line">		&amp;redirect_uri=https://music.163.com/back/qq</span><br><span class="line">		&amp;forcelogin=<span class="literal">true</span></span><br><span class="line">		&amp;state=ichQQlAgNi</span><br><span class="line">		&amp;checkToken=sretfyguihojpr</span><br></pre></td></tr></table></figure><p>我们看到参数基本一致，至于还多几个，有什么用这里就没有去深究了。</p><p>2）在C中，认证服务器返回的URI中，需要包含下面这些参数：</p><table><thead><tr><th>参数名称</th><th>参数含义</th><th>是否必须</th></tr></thead><tbody><tr><td>code</td><td>授权码。认证服务器返回的授权码，生命周期不超过10分钟，而且要求只能使用一次，和A中的<code>client_id</code>,<code>redirect_uri</code>绑定。</td><td>必须</td></tr><tr><td>state</td><td>如果A中请求包含这个参数，资源服务器原封不动的返回。</td><td>可选</td></tr></tbody></table><p>如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 302 Found</span><br><span class="line">Location: https://client.example.com/cb?code=SplxlOBeZQQYbYS6WxSbIA</span><br><span class="line">          &amp;state=xyz</span><br></pre></td></tr></table></figure><p>3) 在D中客户端向认证服务器申请令牌(access_token)时，需要包含下面这些参数。</p><table><thead><tr><th>参名称</th><th>参数含义</th><th>是否必须</th></tr></thead><tbody><tr><td>grant_type</td><td>授权模式，此处为<code>authorization_code</code>。</td><td>必须</td></tr><tr><td>code</td><td>授权码，C中获取的<code>code</code>。</td><td>必须</td></tr><tr><td>redirect_uri</td><td>重定向URI，需要和A中一致。</td><td>必须</td></tr><tr><td>client_id</td><td>客户端ID，与A中一致。</td><td>必须</td></tr></tbody></table><p>如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST /token HTTP/1.1</span><br><span class="line">Host: server.example.com</span><br><span class="line">Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">grant_type=authorization_code&amp;code=SplxlOBeZQQYbYS6WxSbIA</span><br><span class="line">&amp;redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb</span><br></pre></td></tr></table></figure><p>4) 在E中，认证服务器返回的信息中，包含下面参数：</p><table><thead><tr><th>参数名称</th><th>参数含义</th><th>是否必须</th></tr></thead><tbody><tr><td>access_token</td><td>访问令牌</td><td>必须</td></tr><tr><td>token_type</td><td>令牌类型，大小写不敏感。例如 Bearer，MAC。</td><td>必须</td></tr><tr><td>expires_in</td><td>过期时间(s)， 如果不设置也要通过其他方法设置一个。</td><td>推荐</td></tr><tr><td>refresh_token</td><td>更新令牌的token。当令牌过期的时候，可用通过该值刷新token。</td><td>可选</td></tr><tr><td>scope</td><td>权限范围，如果与客户端申请范围一致，可省略。</td><td>可选</td></tr></tbody></table><p>如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/json;charset=UTF-8</span><br><span class="line">Cache-Control: no-store</span><br><span class="line">Pragma: no-cache</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"access_token"</span>:<span class="string">"2YotnFZFEjr1zCsicMWpAA"</span>,</span><br><span class="line">  <span class="string">"token_type"</span>:<span class="string">"example"</span>,</span><br><span class="line">  <span class="string">"expires_in"</span>:3600,</span><br><span class="line">  <span class="string">"refresh_token"</span>:<span class="string">"tGzv3JOkF0XG5Qx2TlKWIA"</span>,</span><br><span class="line">  <span class="string">"example_parameter"</span>:<span class="string">"example_value"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5) 如果我们的令牌过期了，需要更新，这里就需要使用<code>refresh_token</code>获取一个新令牌了。此时发起HTTP请求需要的参数有：</p><table><thead><tr><th>参数名称</th><th>参数含义</th><th>是否必须</th></tr></thead><tbody><tr><td>grant_type</td><td>授权类型，此处是<code>refresh_token</code></td><td>必须</td></tr><tr><td>refresh_token</td><td>更新令牌的token。</td><td>必须</td></tr><tr><td>scope</td><td>权限范围。</td><td>可选</td></tr></tbody></table><p>如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /token HTTP/1.1</span><br><span class="line">Host: server.example.com</span><br><span class="line">Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">grant_type=refresh_token&amp;refresh_token=tGzv3JOkF0XG5Qx2TlKWIA</span><br></pre></td></tr></table></figure><p>这就是授权码模式，应该也是我们平常见的较多的模式了。</p><h5 id="简化模式-Implicit"><a href="#简化模式-Implicit" class="headerlink" title="简化模式 (Implicit)"></a>简化模式 (Implicit)</h5><p>简化模式，相当于授权码模式中，C步骤不再通过客户端，直接在浏览器<code>(user-agent)</code>中向认证服务器申请令牌，认证服务器不再返回授权码，所有步骤都在浏览器中完成，最后资源服务器将令牌放在<code>Fragment</code>中，浏览器从中将令牌提取，发送给客户端。</p><p>所以这个令牌对访问者时可见的，而且客户端不需要认证。详细流程如下。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">+----------+</span><br><span class="line">| Resource |</span><br><span class="line">|  Owner   |</span><br><span class="line">|          |</span><br><span class="line">+----------+</span><br><span class="line">     ^</span><br><span class="line">     |</span><br><span class="line">    (B)</span><br><span class="line">+----|-----+          Client Identifier     +---------------+</span><br><span class="line">|         -+----(A)-- &amp; Redirection URI ---&gt;|               |</span><br><span class="line">|  User-   |                                | Authorization |</span><br><span class="line">|  Agent  -|----(B)-- User authenticates --&gt;|     Server    |</span><br><span class="line">|          |                                |               |</span><br><span class="line">|          |&lt;---(C)--- Redirection URI ----&lt;|               |</span><br><span class="line">|          |          with Access Token     +---------------+</span><br><span class="line">|          |            in Fragment</span><br><span class="line">|          |                                +---------------+</span><br><span class="line">|          |----(D)--- Redirection URI ----&gt;|   Web-Hosted  |</span><br><span class="line">|          |          without Fragment      |     Client    |</span><br><span class="line">|          |                                |    Resource   |</span><br><span class="line">|     (F)  |&lt;---(E)------- Script ---------&lt;|               |</span><br><span class="line">|          |                                +---------------+</span><br><span class="line">+-|--------+</span><br><span class="line">  |    |</span><br><span class="line"> (A)  (G) Access Token</span><br><span class="line">  |    |</span><br><span class="line">  ^    v</span><br><span class="line">+---------+</span><br><span class="line">|         |</span><br><span class="line">|  Client |</span><br><span class="line">|         |</span><br><span class="line">+---------+</span><br></pre></td></tr></table></figure><ul><li>(A) 客户端将用户导向认证服务器， 携带客户端ID及重定向URI；</li><li>(B) 用户是否授权；</li><li>(C) 用户同意授权后，认证服务器重定向到A中指定的URI，并且在URI的<code>Fragment</code>中包含了访问令牌；</li><li>(D) 浏览器向资源服务器发出请求，该请求中不包含C中的<code>Fragment</code>值；</li><li>(E) 资源服务器返回一个网页，其中包含了可以提取C中<code>Fragment</code>里面访问令牌的脚本；</li><li>(F) 浏览器执行E中获得的脚本，提取令牌；</li><li>(G) 浏览器将令牌发送给客户端。</li></ul><p>1）在A步骤中，客户端发送请求，需要包含这些参数：</p><table><thead><tr><th>参数名称</th><th>参数含义</th><th>是否必须</th></tr></thead><tbody><tr><td>response_type</td><td>授权类型，此处值为<code>token</code>。</td><td>必须</td></tr><tr><td>client_id</td><td>客户端的ID。</td><td>必须</td></tr><tr><td>redirect_uri</td><td>重定向的URI。</td><td>可选</td></tr><tr><td>scope</td><td>权限范围。</td><td>可选</td></tr><tr><td>state</td><td>客户端的当前状态。指定后服务器会原封不动返回。</td><td>推荐</td></tr></tbody></table><p>如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /authorize?response_type=token&amp;client_id=s6BhdRkqt3&amp;state=xyz</span><br><span class="line">    &amp;redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb HTTP/1.1</span><br><span class="line">Host: server.example.com</span><br></pre></td></tr></table></figure><p>2) 在C中，认证服务器返回的URI中，参数主要有：</p><table><thead><tr><th>参数名称</th><th>参数含义</th><th>是否必须</th></tr></thead><tbody><tr><td>access_token</td><td>访问令牌。</td><td>必须</td></tr><tr><td>token_type</td><td>令牌类型。</td><td>必须</td></tr><tr><td>expires_in</td><td>过期时间。</td><td>推荐</td></tr><tr><td>scope</td><td>权限范围。</td><td>可选</td></tr><tr><td>state</td><td>客户端访问时如果指定了，原封不动返回。</td><td>可选</td></tr></tbody></table><p>如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 302 Found</span><br><span class="line">Location: http://example.com/cb<span class="comment">#access_token=2YotnFZFEjr1zCsicMWpAA</span></span><br><span class="line">          &amp;state=xyz&amp;token_type=example&amp;expires_in=3600</span><br></pre></td></tr></table></figure><p>我们可以看到C中返回的是一个重定向，而重定向的这个网址的<code>Fragment</code>部分包含了令牌。</p><p>D步骤中就是访问这个重定向指定的URI，而且不带<code>Fragment</code>部分，服务器会返回从<code>Fragment</code>中提取令牌的脚本，最后浏览器运行脚本获取到令牌发送给客户端。</p><h5 id="密码模式-Resource-Owner-Password-Credentials"><a href="#密码模式-Resource-Owner-Password-Credentials" class="headerlink" title="密码模式 (Resource Owner Password Credentials)"></a>密码模式 (Resource Owner Password Credentials)</h5><p>密码模式就是用户直接将用户名密码提供给客户端，客户端使用这些信息到认证服务器请求授权。具体流程如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">+----------+</span><br><span class="line">| Resource |</span><br><span class="line">|  Owner   |</span><br><span class="line">|          |</span><br><span class="line">+----------+</span><br><span class="line">     v</span><br><span class="line">     |    Resource Owner</span><br><span class="line">    (A) Password Credentials</span><br><span class="line">     |</span><br><span class="line">     v</span><br><span class="line">+---------+                                  +---------------+</span><br><span class="line">|         |&gt;--(B)---- Resource Owner -------&gt;|               |</span><br><span class="line">|         |         Password Credentials     | Authorization |</span><br><span class="line">| Client  |                                  |     Server    |</span><br><span class="line">|         |&lt;--(C)---- Access Token ---------&lt;|               |</span><br><span class="line">|         |    (w/ Optional Refresh Token)   |               |</span><br><span class="line">+---------+                                  +---------------+</span><br><span class="line"></span><br><span class="line">       Figure 5: Resource Owner Password Credentials Flow</span><br></pre></td></tr></table></figure><ul><li>(A) 资源所有者提供用户名密码给客户端；</li><li>(B) 客户端拿着用户名密码去认证服务器请求令牌；</li><li>(C) 认证服务器确认后，返回令牌；</li></ul><p>1) 在B中客户端发送的请求中，需要包含这些参数：</p><table><thead><tr><th>参数名称</th><th>参数含义</th><th>是否必须</th></tr></thead><tbody><tr><td>grant_type</td><td>授权类型，此处值为<code>password</code>。</td><td>必须</td></tr><tr><td>username</td><td>用户名。</td><td>必须</td></tr><tr><td>password</td><td>用户的密码。</td><td>必须</td></tr><tr><td>scope</td><td>权限范围。</td><td>可选</td></tr></tbody></table><p>如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /token HTTP/1.1</span><br><span class="line">Host: server.example.com</span><br><span class="line">Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">grant_type=password&amp;username=johndoe&amp;password=A3ddj3w</span><br></pre></td></tr></table></figure><p>3) 在C中，认证服务器返回访问令牌。如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/json;charset=UTF-8</span><br><span class="line">Cache-Control: no-store</span><br><span class="line">Pragma: no-cache</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"access_token"</span>:<span class="string">"2YotnFZFEjr1zCsicMWpAA"</span>,</span><br><span class="line">  <span class="string">"token_type"</span>:<span class="string">"example"</span>,</span><br><span class="line">  <span class="string">"expires_in"</span>:3600,</span><br><span class="line">  <span class="string">"refresh_token"</span>:<span class="string">"tGzv3JOkF0XG5Qx2TlKWIA"</span>,</span><br><span class="line">  <span class="string">"example_parameter"</span>:<span class="string">"example_value"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="客户端模式-Client-Credentials"><a href="#客户端模式-Client-Credentials" class="headerlink" title="客户端模式 (Client Credentials)"></a>客户端模式 (Client Credentials)</h5><p>客户端模式，其实就是客户端直接向认证服务器请求令牌。而用户直接在客户端注册即可，一般用于后端 API 的相关操作。其流程如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">+---------+                                  +---------------+</span><br><span class="line">|         |                                  |               |</span><br><span class="line">|         |&gt;--(A)- Client Authentication ---&gt;| Authorization |</span><br><span class="line">| Client  |                                  |     Server    |</span><br><span class="line">|         |&lt;--(B)---- Access Token ---------&lt;|               |</span><br><span class="line">|         |                                  |               |</span><br><span class="line">+---------+                                  +---------------+</span><br><span class="line"></span><br><span class="line">                Figure 6: Client Credentials Flow</span><br></pre></td></tr></table></figure><ul><li>(A) 客户端发起身份认证，请求访问令牌；</li><li>(B) 认证服务器确认无误，返回访问令牌。</li></ul><p>1) 在A中，客户端发起请求的参数有：</p><table><thead><tr><th>参数名称</th><th>参数含义</th><th>是否必须</th></tr></thead><tbody><tr><td>grant_type</td><td>授权类型，此处值为<code>client_credentials</code>。</td><td>必须</td></tr><tr><td>scope</td><td>权限范围。</td><td>可选</td></tr></tbody></table><p>如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /token HTTP/1.1</span><br><span class="line">Host: server.example.com</span><br><span class="line">Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">grant_type=client_credentials</span><br></pre></td></tr></table></figure><p>2） 认证服务器认证后，发放访问令牌，如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/json;charset=UTF-8</span><br><span class="line">Cache-Control: no-store</span><br><span class="line">Pragma: no-cache</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"access_token"</span>:<span class="string">"2YotnFZFEjr1zCsicMWpAA"</span>,</span><br><span class="line">  <span class="string">"token_type"</span>:<span class="string">"example"</span>,</span><br><span class="line">  <span class="string">"expires_in"</span>:3600,</span><br><span class="line">  <span class="string">"example_parameter"</span>:<span class="string">"example_value"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实现OAuth-2-0"><a href="#实现OAuth-2-0" class="headerlink" title="实现OAuth 2.0"></a>实现OAuth 2.0</h3><p>上面我们一起了解了OAuth 2.0的流程，现在我们开始实现OAuth 2.0。</p><p>首先，我需要一个使用场景，大概是这样的。</p><blockquote><p>我有一个需要登录的应用（web app)。<br>用户可以选择使用github登录。<br>登录后，显示一个简单的欢迎页面。</p></blockquote><p>有了这个场景后，我们开始设计（这里我们实现的是第一种授权码模式）。</p><h4 id="登录页面"><a href="#登录页面" class="headerlink" title="登录页面"></a>登录页面</h4><p>在这里，我们充当的角色就是<code>client</code>,我们需要一个简单的页面，让用户选择使用<code>github</code>登录。</p><p>这是一个简单的html页面，<code>public/index.html</code>页面。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://github.com/login/oauth/authorize?client_id=89ac6f58f15f658d8dd5&amp;redirect_uri=http://localhost:8080/oauth/redirect"</span>&gt;</span></span><br><span class="line">    Login with github</span><br><span class="line">  <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>也就是当用户点击<code>Login with github</code>会访问</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/login/oauth/authorize?</span><br><span class="line">		client_id=89ac6f58f15f658d8dd5</span><br><span class="line">		&amp;redirect_uri=http://localhost:8080/oauth/redirect</span><br></pre></td></tr></table></figure><p>其中：</p><ul><li><p><code>https://github.com/login/oauth/authorize</code> 是GitHub的OAuth网关地址。</p></li><li><p><code>client_id=89ac6f58f15f658d8dd5</code> 这个是我申请的客户端ID，</p><p>需要到<a href="https://github.com/settings/applications/new" target="_blank" rel="noopener">https://github.com/settings/applications/new</a>注册。</p><p>注册过程很简单，但要注意，最后一栏<code>Authorization callback URL</code>是和下面<code>redirect_uri</code>一致。</p><p>如：</p><p><img data-src="https://st.razeen.cn/img/blog/Jietu20190208-230400.png" alt></p><p>成功后你会获的<code>Client ID</code>与<code>Client Secret</code>, 前者就是这里的<code>client_id</code>，两者在后面的编码中需要用到。</p></li><li><p><code>redirect_uri=http://localhost:8080/oauth/redirect</code> 当用户确认，获取权限后重定向到的该地址。</p></li></ul><p>然后我们写个<code>mian.go</code>, 启动一个简单的服务。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fs := http.FileServer(http.Dir(<span class="string">"public"</span>))</span><br><span class="line">	http.Handle(<span class="string">"/"</span>, fs)</span><br><span class="line"></span><br><span class="line">	http.ListenAndServe(<span class="string">":8080"</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>写到这里，我们代码已经能跑起了，如果你点击<code>Login with github</code>我们会看到如下的授权页面。</p><p><img data-src="https://st.razeen.cn/img/blog/Jietu20190208-232606.png" alt></p><p>当我们确定过后，会重定向到我们指定的地址，而且带上<code>code</code>,如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/oauth/redirect?code=260f17a7308f2c566725</span><br></pre></td></tr></table></figure><p>此时我们需要做的是，拿着该code去请求访问令牌(access_token)，对应授权码模式中的D步骤。</p><h4 id="重定向路由"><a href="#重定向路由" class="headerlink" title="重定向路由"></a>重定向路由</h4><p>现在我们有<code>code</code>了，我们需要去请求令牌。接下来我们就需要向<code>https://github.com/login/oauth/access_token</code>发送POST请求获取访问令牌(access_token)。</p><blockquote><p>关于更多GitHub重定向URI的信息你可以看<a href="https://developer.github.com/apps/building-oauth-apps/authorizing-oauth-apps/#2-users-are-redirected-back-to-your-site-by-github" target="_blank" rel="noopener">这里</a>。</p></blockquote><p>现在，让我们将<code>/oauth/redirect</code>路由补全，在该步骤中请求访问令牌(access_token)。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"encoding/json"</span></span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"log"</span></span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 你在注册时得到的</span></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	clientID     = <span class="string">"你的客户端ID"</span></span><br><span class="line">	clientSecret = <span class="string">"你的客户端密钥"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> httpClient = http.Client&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> OAuthAccessResponse <span class="keyword">struct</span> &#123;</span><br><span class="line">	AccessToken <span class="keyword">string</span> <span class="string">`json:"access_token"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fs := http.FileServer(http.Dir(<span class="string">"public"</span>))</span><br><span class="line">	http.Handle(<span class="string">"/"</span>, fs)</span><br><span class="line">	http.HandleFunc(<span class="string">"/oauth/redirect"</span>, HandleOAuthRedirect)</span><br><span class="line"></span><br><span class="line">	http.ListenAndServe(<span class="string">":8080"</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// HandleOAuthRedirect doc</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">HandleOAuthRedirect</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	<span class="comment">// 首先，我们从URI中解析出code参数</span></span><br><span class="line">	<span class="comment">// 如: http://localhost:8080/oauth/redirect?code=260f17a7308f2c566725</span></span><br><span class="line">	err := r.ParseForm()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Printf(<span class="string">"could not parse query: %v"</span>, err)</span><br><span class="line">		w.WriteHeader(http.StatusBadRequest)</span><br><span class="line">	&#125;</span><br><span class="line">	code := r.FormValue(<span class="string">"code"</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 接下来，我们通过 clientID,clientSecret,code 获取授权密钥</span></span><br><span class="line">	<span class="comment">// 前者是我们在注册时得到的，后者是用户确认后，重定向到该路由，从中获取到的。</span></span><br><span class="line">	reqURL := fmt.Sprintf(<span class="string">"https://github.com/login/oauth/access_token?client_id=%s&amp;client_secret=%s&amp;code=%s"</span>,</span><br><span class="line">		clientID, clientSecret, code)</span><br><span class="line">	req, err := http.NewRequest(http.MethodPost, reqURL, <span class="literal">nil</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Printf(<span class="string">"could not create HTTP request: %v"</span>, err)</span><br><span class="line">		w.WriteHeader(http.StatusBadRequest)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置我们期待返回的格式为json</span></span><br><span class="line">	req.Header.Set(<span class="string">"accept"</span>, <span class="string">"application/json"</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 发送http请求</span></span><br><span class="line">	res, err := httpClient.Do(req)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Printf(<span class="string">"could not send HTTP request: %v"</span>, err)</span><br><span class="line">		w.WriteHeader(http.StatusInternalServerError)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> res.Body.Close()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 解析</span></span><br><span class="line">	<span class="keyword">var</span> t OAuthAccessResponse</span><br><span class="line">	<span class="keyword">if</span> err := json.NewDecoder(res.Body).Decode(&amp;t); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Printf(<span class="string">"could not parse JSON response: %v"</span>, err)</span><br><span class="line">		w.WriteHeader(http.StatusBadRequest)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 最后获取到access_token后，我们重定向到欢迎页面，也就是表示用户登录成功，同属获取一些用户的基本展示信息</span></span><br><span class="line">	w.Header().Set(<span class="string">"Location"</span>, <span class="string">"/welcome.html?access_token="</span>+t.AccessToken)</span><br><span class="line">	w.WriteHeader(http.StatusFound)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="欢迎页面"><a href="#欢迎页面" class="headerlink" title="欢迎页面"></a>欢迎页面</h4><p>上面我们拿到了访问令牌，同时，我们重定向到了欢迎页面。接下来，我们就在欢迎页中获取用户的GitHub名称作为展示。</p><p>添加<code>public/welcome.html</code>页面。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">	// 获取access_token</span><br><span class="line">	const query = window.location.search.substring(1)</span><br><span class="line">	const token = query.split('access_token=')[1]</span><br><span class="line"></span><br><span class="line">	// 访问资源服务器地址，获取相关资源</span><br><span class="line">	fetch('https://api.github.com/user', &#123;</span><br><span class="line">			headers: &#123;</span><br><span class="line">                // 将token放在Header中</span><br><span class="line">				Authorization: 'token ' + token</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;)</span><br><span class="line">		// 解析返回的JSON</span><br><span class="line">		.then(res =&gt; res.json())</span><br><span class="line">		.then(res =&gt; &#123;</span><br><span class="line">            // 这里我们能得到很多信息</span><br><span class="line">			// 具体看这里 https://developer.github.com/v3/users/#get-the-authenticated-user</span><br><span class="line">			// 这里我们就只展示一下用户名了</span><br><span class="line">			const nameNode = document.createTextNode(`Welcome, $&#123;res.name&#125;`)</span><br><span class="line">			document.body.appendChild(nameNode)</span><br><span class="line">		&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>到这里，我们再次运行程序，点击<code>Login with github</code>，同意后我们可以看到类似<code>Welcome, Razeen</code>的信息，此时我们已经完成整个OAuth 2.0的流程了。</p><blockquote><p>获得授权之后，我们能访问的API不仅仅有这些，更多的请看<a href="https://developer.github.com/v3/" target="_blank" rel="noopener">这里</a>。</p></blockquote><p><em>源码在<a href="https://github.com/razeencheng/demo-go/tree/master/oauth2" target="_blank" rel="noopener">这里</a>。</em></p><h3 id="关于安全"><a href="#关于安全" class="headerlink" title="关于安全"></a>关于安全</h3><ol><li><p>这里我们将访问令牌直接放在了URI中，这么做其实是不安全的。更好的做法是我们创建一个会话session，将cooike发送给用户即可。</p></li><li><p>在前面OAuth 2.0的解释中，我们知道在请求权限的过程中，我们可以加上<code>state</code>字段，如</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/login/oauth/authorize？</span><br><span class="line">		client_id=89ac6f58f15f658d8dd5</span><br><span class="line">		&amp;redirect_uri=http://localhost:8080/oauth/redirect</span><br><span class="line">		&amp;state=xxxxx</span><br></pre></td></tr></table></figure><p>而服务器会原封不动的返回该state。这样我们可以将该字段设置一些随机值，如果资源服务器返回的<code>state</code>值与我们设置的不同，我们认为该请求不是来自正确的资源服务器，应该拒绝。</p></li></ol><p><strong>参考</strong></p><ul><li><p><a href="https://tools.ietf.org/html/rfc6749" target="_blank" rel="noopener">FRC6749</a></p></li><li><p><a href="https://www.sohamkamani.com/blog/golang/2018-06-24-oauth-with-golang/" target="_blank" rel="noopener">Implementing OAuth 2.0 with Go(Golang)</a></p></li><li><p><a href="https://deepzz.com/post/what-is-oauth2-protocol.html" target="_blank" rel="noopener">10 分钟理解什么是 OAuth 2.0 协议</a></p></li><li><p><a href="http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html" target="_blank" rel="noopener">理解OAuth 2.0</a></p></li></ul></div><div class="popular-posts-header">相关文章</div><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><a href="/post/breaking-all-the-rules-using-go-to-call-windows-api.html" rel="bookmark">如何用 Go 调用 Windows API</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/post/daily-go-recover.html" rel="bookmark">Go学习笔记(二) | 我对 recover 的一点误解</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/post/daily-pg-tips.html" rel="bookmark">Go学习笔记(一) | postgres与golang点点滴滴</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/post/gin-file-down-upload.html" rel="bookmark">Gin文件上传与下载</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/post/go-snippets.html" rel="bookmark">Go学习笔记(五) | 使用代码片段(snippets)提高编码效率</a></div></li></ul><div class="reward-container"><div>如果觉得文章对您有帮助，点两下右边广告将是对我莫大的鼓励，非常感谢！</div><button onclick='var qr=document.getElementById("qr");qr.style.display="none"===qr.style.display?"block":"none"'>打赏</button><div id="qr" style="display:none"><div style="display:inline-block"><img src="https://st.razeen.cn/img/20210702001743-image-20210702001741636.png" alt="Razeen 微信支付"><p>微信支付</p></div></div></div><div class="followme"><p>欢迎关注我的其它发布渠道</p><div class="social-list"><div class="social-item"><a target="_blank" class="social-link" href="https://twitter.com/razeencheng"><span class="icon"><i class="fab fa-twitter"></i> </span><span class="label">Twitter</span></a></div><div class="social-item"><a target="_blank" class="social-link" href="/atom.xml"><span class="icon"><i class="fa fa-rss"></i> </span><span class="label">RSS</span></a></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/golang/" rel="tag"># golang</a> <a href="/tags/oauth/" rel="tag"># oauth</a></div><div class="post-nav"><div class="post-nav-item"><a href="/post/blog-migration-hexo-next.html" rel="prev" title="我又又又把博客迁移了"><i class="fa fa-chevron-left"></i> 我又又又把博客迁移了</a></div><div class="post-nav-item"><a href="/post/mime-types-quick-look.html" rel="next" title="MIME Types 速查表">MIME Types 速查表 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="tabs tabs-comment"><ul class="nav-tabs"><li class="tab"><a href="#comment-disqus">Disqus</a></li><li class="tab"><a href="#comment-gitalk">Gitalk</a></li></ul><div class="tab-content"><div class="tab-pane disqus" id="comment-disqus"><div class="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript></div></div></div><div class="tab-pane gitalk" id="comment-gitalk"><div class="comments" id="gitalk-container"></div></div></div></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#理解OAuth-2-0"><span class="nav-number">1.</span> <span class="nav-text">理解OAuth 2.0</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#相关名词"><span class="nav-number">1.1.</span> <span class="nav-text">相关名词</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#协议流程"><span class="nav-number">1.2.</span> <span class="nav-text">协议流程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#授权模式"><span class="nav-number">1.3.</span> <span class="nav-text">授权模式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#授权码模式-Authorization-Code"><span class="nav-number">1.3.1.</span> <span class="nav-text">授权码模式 (Authorization Code)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#简化模式-Implicit"><span class="nav-number">1.3.2.</span> <span class="nav-text">简化模式 (Implicit)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#密码模式-Resource-Owner-Password-Credentials"><span class="nav-number">1.3.3.</span> <span class="nav-text">密码模式 (Resource Owner Password Credentials)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#客户端模式-Client-Credentials"><span class="nav-number">1.3.4.</span> <span class="nav-text">客户端模式 (Client Credentials)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实现OAuth-2-0"><span class="nav-number">2.</span> <span class="nav-text">实现OAuth 2.0</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#登录页面"><span class="nav-number">2.1.</span> <span class="nav-text">登录页面</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#重定向路由"><span class="nav-number">2.2.</span> <span class="nav-text">重定向路由</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#欢迎页面"><span class="nav-number">2.3.</span> <span class="nav-text">欢迎页面</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#关于安全"><span class="nav-number">3.</span> <span class="nav-text">关于安全</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Razeen" src="https://st.razeen.cn/static/img/avatar.png"><p class="site-author-name" itemprop="name">Razeen</p><div class="site-description" itemprop="description">My name is ChengJin, I use @Razeen and @RazeenCheng on web. I'm a gopher+. Currently I'm working for a company about information security.</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">61</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">25</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">89</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/razeencheng" title="GitHub → https://github.com/razeencheng" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:me@razeen.me" title="E-Mail → mailto:me@razeen.me" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a></span></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://yryz.net/" title="https://yryz.net/" rel="noopener" target="_blank">一人游走</a></li><li class="links-of-blogroll-item"><a href="https://deepzz.com/" title="https://deepzz.com/" rel="noopener" target="_blank">Deepzz</a></li><li class="links-of-blogroll-item"><a href="https://wangcch.cc/" title="https://wangcch.cc/" rel="noopener" target="_blank">Demon Wang</a></li><li class="links-of-blogroll-item"><a href="http://blog.tommyyang.cn/" title="http://blog.tommyyang.cn/" rel="noopener" target="_blank">Tommy Yang’s Blog</a></li></ul></div></div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4450478767591566" data-ad-slot="8164928618" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Razeen</span></div><div class="seal"><img style="width:auto;height:44px;cursor:pointer;display:inline-block;margin-right:5px" onclick='window.open("https://myssl.com/seal/detail?domain=razeencheng.com","TrustAsia 安全签章","height=800,width=470,top=0,right=0,toolbar=no,menubar=no,scrollbars=no,resizable=no,location=no,status=no")' src="https://sealres.trustasia.com/seal/img/1x/seal.png?domain=razeencheng.com" alt="TrustAsia 安全签章"></div></div></footer></div><script src="https://st.razeen.cn/next2021/lib/anime.min.js"></script><script src="https://st.razeen.cn/next2021/lib/fancybox/jquery.min.js"></script><script src="https://st.razeen.cn/next2021/lib/fancybox/jquery.fancybox.min.js"></script><script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script><script src="/js/utils.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script>!function(t,h,e,j){t.hj=t.hj||function(){(t.hj.q=t.hj.q||[]).push(arguments)},t._hjSettings={hjid:1271072,hjsv:6},e=h.getElementsByTagName("head")[0],(j=h.createElement("script")).async=1,j.src="https://static.hotjar.com/c/hotjar-"+t._hjSettings.hjid+".js?sv="+t._hjSettings.hjsv,e.appendChild(j)}(window,document)</script><script>var disqus_config=function(){this.page.url="https://razeencheng.com/post/oauth2-protocol-details.html",this.page.identifier="/post/oauth2-protocol-details.html",this.page.title="Go学习笔记(七) | 理解OAuth 2.0并实现一个客户端"};NexT.utils.loadComments(document.querySelector("#disqus_thread"),()=>{var t,e;window.DISQUS?DISQUS.reset({reload:!0,config:disqus_config}):((e=(t=document).createElement("script")).src="https://razeen-me.disqus.com/embed.js",e.setAttribute("data-timestamp",""+ +new Date),(t.head||t.body).appendChild(e))})</script><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css"><script>NexT.utils.loadComments(document.querySelector("#gitalk-container"),()=>{NexT.utils.getScript("//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js",()=>{new Gitalk({clientID:"b18687c280aea769c18f",clientSecret:"a59a7ae4e158c9a80707e7ee1e13a3173fc34b7c",repo:"blog-comment",owner:"razeencheng",admin:["razeencheng"],id:"44d4a12a798824b769a25ac37f2e36ef",language:"zh-CN",distractionFreeMode:!0}).render("gitalk-container")},window.Gitalk)})</script></body></html>